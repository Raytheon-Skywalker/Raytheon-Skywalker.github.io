<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="keywords" content="Hexo Theme Keep"><meta name="description" content="Hexo Theme Keep"><meta name="author" content="Raytheon Skywalker"><title>构建Docker Swarm Env | Raytheon Skywalker</title><link rel="stylesheet" href="/css/style.css"><link rel="shortcut icon" href="/images/logo.png"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/css/font-awesome.min.css"><script id="hexo-configurations">let KEEP=window.KEEP||{};KEEP.hexo_config={hostname:"example.com",root:"/",language:"en",path:"search.json"},KEEP.theme_config={toc:{enable:!0,number:!0,expand_all:!1,init_open:!1},style:{primary_color:"#0066CC",avatar:"/images/avatar.png",favicon:"/images/logo.png",article_img_align:"left",left_side_width:"260px",content_max_width:"920px",hover:{shadow:!1,scale:!1},first_screen:{enable:!0,background_img:"/images/bg.svg",description:"KEEP CALM AND CARRY ON."},scroll:{progress_bar:{enable:!1},percent:{enable:!1}}},local_search:{enable:!0,preload:!0},code_copy:{enable:!1,style:"default"},pjax:{enable:!1},lazyload:{enable:!0},version:"3.4.2"},KEEP.language_ago={second:"%s seconds ago",minute:"%s minutes ago",hour:"%s hours ago",day:"%s days ago",week:"%s weeks ago",month:"%s months ago",year:"%s years ago"}</script><meta name="generator" content="Hexo 5.4.0"></head><body><div class="progress-bar-container"></div><main class="page-container"><div class="page-main-content"><div class="page-main-content-top"><header class="header-wrapper"><div class="header-content"><div class="left"><a class="logo-title" href="/">Raytheon Skywalker</a></div><div class="right"><div class="pc"><ul class="menu-list"><li class="menu-item"><a href="/">HOME</a></li><li class="menu-item"><a href="/archives">ARCHIVES</a></li><li class="menu-item"><a href="/categories">CATEGORIES</a></li><li class="menu-item"><a href="/tags">TAGS</a></li><li class="menu-item"><a href="/about">ABOUT</a></li><li class="menu-item search search-popup-trigger"><i class="fas fa-search"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fas fa-search"></i></div><div class="icon-item menu-bar"><div class="menu-bar-middle"></div></div></div></div></div><div class="header-drawer"><ul class="drawer-menu-list"><li class="drawer-menu-item flex-center"><a href="/">HOME</a></li><li class="drawer-menu-item flex-center"><a href="/archives">ARCHIVES</a></li><li class="drawer-menu-item flex-center"><a href="/categories">CATEGORIES</a></li><li class="drawer-menu-item flex-center"><a href="/tags">TAGS</a></li><li class="drawer-menu-item flex-center"><a href="/about">ABOUT</a></li></ul></div><div class="window-mask"></div></header></div><div class="page-main-content-middle"><div class="main-content"><div class="fade-in-down-animation"><div class="article-content-container"><div class="article-title"><span class="title-hover-animation">构建Docker Swarm Env</span></div><div class="article-header"><div class="avatar"><img src="/images/avatar.png"></div><div class="info"><div class="author"><span class="name">Raytheon Skywalker</span> <span class="author-label">Lv3</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fas fa-edit"></i>&nbsp;2019-04-09 18:38:38 </span><span class="article-categories article-meta-item"><i class="fas fa-folder"></i>&nbsp;<ul><li><a href="/categories/Dev-life/">Dev life</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fas fa-tags"></i>&nbsp;<ul><li><a href="/tags/Dev-life/">Dev life</a>&nbsp;</li><li>| <a href="/tags/Docker/">Docker</a>&nbsp;</li><li>| <a href="/tags/SWARM/">SWARM</a>&nbsp;</li><li>| <a href="/tags/Container/">Container</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fas fa-file-word"></i>&nbsp;<span>3.2k Words</span> </span><span class="article-min2read article-meta-item"><i class="fas fa-clock"></i>&nbsp;<span>15 Mins</span></span></div></div></div></div><div class="article-content markdown-body"><blockquote><p>如何在日常的开发过程中使用Docker SWARM技术.</p></blockquote><ol><li><h2 id="一些docker快捷操作"><a href="#一些docker快捷操作" class="headerlink" title="一些docker快捷操作"></a>一些docker快捷操作</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 删除容器</span></span><br><span class="line">docker ps -a | awk <span class="string">&#x27;&#123;if (NR !=1) print $1&#125;&#x27;</span> | xargs docker stop | xargs docker rm -f</span><br><span class="line"><span class="comment">#删除镜像</span></span><br><span class="line">docker images | awk <span class="string">&#x27;/^com\.emapgo/ &#123;print $3&#125;&#x27;</span> | xargs docker rmi    </span><br></pre></td></tr></table></figure></li><li><h2 id="私有仓库docker-registry"><a href="#私有仓库docker-registry" class="headerlink" title="私有仓库docker-registry"></a><a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/registry/">私有仓库docker-registry<i class="fas fa-external-link-alt"></i></a></h2><ol><li><h2 id="安装具体请参照–-gt-产品级部署-deploy-a-production-ready-registry"><a href="#安装具体请参照–-gt-产品级部署-deploy-a-production-ready-registry" class="headerlink" title="安装具体请参照–&gt;产品级部署 deploy a production-ready registry"></a>安装<a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/registry/configuration/">具体请参照–&gt;产品级部署 deploy a production-ready registry<i class="fas fa-external-link-alt"></i></a></h2><ol><li><h2 id="基本安装"><a href="#基本安装" class="headerlink" title="基本安装"></a>基本安装</h2><h2 id="Docker私服搭建及上传自己镜像到私服仓库"><a href="#Docker私服搭建及上传自己镜像到私服仓库" class="headerlink" title="Docker私服搭建及上传自己镜像到私服仓库"></a><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/qq_39623859/article/details/79752803">Docker私服搭建及上传自己镜像到私服仓库<i class="fas fa-external-link-alt"></i></a></h2><blockquote><h2 id="要覆盖特定的配置参数，可以在docker-run-的时候通过-e参数或者dockerfile构建镜像的时候通过ENV来设置环境变量达到覆盖配置的目的-如果要覆盖storage-filesystem-rootdirectory-var-lib-registry-那么在-e设置环境变量的时候该参数需要写成-e-REGISTRY-STORAGE-FILESYSTEM-ROOTDIRECTORY-var-lib-registry。还有一种配置registry方式是完全覆盖docker默认配置的方式，需要自己创建一个config-yml文件，在run的时候通过-v命令来指定配置文件路径。"><a href="#要覆盖特定的配置参数，可以在docker-run-的时候通过-e参数或者dockerfile构建镜像的时候通过ENV来设置环境变量达到覆盖配置的目的-如果要覆盖storage-filesystem-rootdirectory-var-lib-registry-那么在-e设置环境变量的时候该参数需要写成-e-REGISTRY-STORAGE-FILESYSTEM-ROOTDIRECTORY-var-lib-registry。还有一种配置registry方式是完全覆盖docker默认配置的方式，需要自己创建一个config-yml文件，在run的时候通过-v命令来指定配置文件路径。" class="headerlink" title="要覆盖特定的配置参数，可以在docker run 的时候通过-e参数或者dockerfile构建镜像的时候通过ENV来设置环境变量达到覆盖配置的目的.如果要覆盖storage.filesystem.rootdirectory=/var/lib/registry 那么在-e设置环境变量的时候该参数需要写成-e REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY=/var/lib/registry。还有一种配置registry方式是完全覆盖docker默认配置的方式，需要自己创建一个config.yml文件，在run的时候通过-v命令来指定配置文件路径。"></a>要覆盖特定的配置参数，可以在docker run 的时候通过-e参数或者dockerfile构建镜像的时候通过ENV来设置环境变量达到覆盖配置的目的.如果要覆盖<code>storage.filesystem.rootdirectory</code>=/var/lib/registry 那么在-e设置环境变量的时候该参数需要写成<code>-e REGISTRY_STORAGE_FILESYSTEM_ROOTDIRECTORY</code>=/var/lib/registry。还有一种配置registry方式是完全覆盖docker默认配置的方式，需要自己创建一个config.yml文件，在run的时候通过-v命令来指定配置文件路径。</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认情况下，仓库会被创建在容器的 /var/lib/registry 目录下。你可以通过 -v 参数来将镜像文件存放在本地的指定路径。</span></span><br><span class="line">sudo mkdir -p /data/docker-base/image-lib &amp;&amp; \</span><br><span class="line">docker run -d -p 5000:5000 --name registry2 --restart=always -v /data/docker-base/image-lib:/var/lib/registry -e REGISTRY_STORAGE_DELETE_ENABLED=<span class="literal">true</span> registry:2</span><br></pre></td></tr></table></figure></blockquote></li><li><h2 id="端口修改，以及存储位置修改"><a href="#端口修改，以及存储位置修改" class="headerlink" title="端口修改，以及存储位置修改"></a>端口修改，以及存储位置修改</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 修改host上的映射端口</span></span><br><span class="line">docker run -d \</span><br><span class="line">    -p 5001:5000 \</span><br><span class="line">    --name registry-test \</span><br><span class="line">    registry:2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改host以及container中的映射端口</span></span><br><span class="line">docker run -d \</span><br><span class="line">    -e REGISTRY_HTTP_ADDR=0.0.0.0:5001 \</span><br><span class="line">    -p 5001:5001 \</span><br><span class="line">    --name registry-test \</span><br><span class="line">    registry:2</span><br><span class="line"></span><br><span class="line"><span class="comment"># 指定存储位置</span></span><br><span class="line">docker run -d \</span><br><span class="line">    -p 5000:5000 \</span><br><span class="line">    --restart=always \</span><br><span class="line">    --name registry \</span><br><span class="line">    -v /mnt/registry:/var/lib/registry \</span><br><span class="line">    registry:2</span><br></pre></td></tr></table></figure><blockquote><h2 id="云存储-store-the-registry-data-in-an-Amazon-S3-bucket-Google-Cloud-Platform-or-on-another-storage-back-end-by-using-storage-drivers"><a href="#云存储-store-the-registry-data-in-an-Amazon-S3-bucket-Google-Cloud-Platform-or-on-another-storage-back-end-by-using-storage-drivers" class="headerlink" title="云存储 store the registry data in an Amazon S3 bucket, Google Cloud Platform, or on another storage back-end by using storage drivers"></a>云存储<a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/registry/deploying/#customize-the-storage-location"> store the registry data in an Amazon S3 bucket, Google Cloud Platform, or on another storage back-end by using storage drivers<i class="fas fa-external-link-alt"></i></a></h2></blockquote></li><li><h2 id="使用HTTPS等访问外部私有仓库Run-an-externally-accessible-registry"><a href="#使用HTTPS等访问外部私有仓库Run-an-externally-accessible-registry" class="headerlink" title="使用HTTPS等访问外部私有仓库Run an externally-accessible registry"></a>使用HTTPS等访问外部私有仓库<a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/registry/deploying/#run-an-externally-accessible-registry">Run an externally-accessible registry<i class="fas fa-external-link-alt"></i></a></h2></li></ol></li><li><h2 id="推送至私有镜像服务器"><a href="#推送至私有镜像服务器" class="headerlink" title="推送至私有镜像服务器"></a>推送至私有镜像服务器</h2><ol><li><h2 id="默认是HTTPS推送-来自DockerHub的images镜像进行本地化并推送至私有镜像仓库"><a href="#默认是HTTPS推送-来自DockerHub的images镜像进行本地化并推送至私有镜像仓库" class="headerlink" title="默认是HTTPS推送 来自DockerHub的images镜像进行本地化并推送至私有镜像仓库"></a>默认是HTTPS推送 <a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/registry/deploying/#copy-an-image-from-docker-hub-to-your-registry">来自DockerHub的images镜像进行本地化并推送至私有镜像仓库<i class="fas fa-external-link-alt"></i></a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 引用了官方的例子</span></span><br><span class="line"><span class="comment"># Pull the ubuntu:16.04 image from Docker Hub.</span></span><br><span class="line">docker pull ubuntu:16.04</span><br><span class="line"><span class="comment"># Tag the image as localhost:5000/my-ubuntu. This creates an additional tag for the existing image. When the first part of the tag is a hostname and port, Docker interprets this as the location of a registry, when pushing.</span></span><br><span class="line">docker tag ubuntu:16.04 localhost:5000/my-ubuntu</span><br><span class="line"><span class="comment"># Push the image to the local registry running at localhost:5000</span></span><br><span class="line">docker push localhost:5000/my-ubuntu</span><br><span class="line"><span class="comment"># 当执行Push之后就可以删除本地缓存的镜像了</span></span><br><span class="line"><span class="comment"># Remove the locally-cached ubuntu:16.04 and localhost:5000/my-ubuntu images, so that you can test pulling the image from your registry. This does not remove the localhost:5000/my-ubuntu image from your registry.</span></span><br><span class="line">docker image remove ubuntu:16.04</span><br><span class="line">docker image remove localhost:5000/my-ubuntu</span><br><span class="line"><span class="comment"># Pull the localhost:5000/my-ubuntu image from your local registry.</span></span><br><span class="line">docker pull localhost:5000/my-ubuntu</span><br></pre></td></tr></table></figure></li><li><h2 id="官方-–-gt-支持HTTP推送-以下操作2选一即可"><a href="#官方-–-gt-支持HTTP推送-以下操作2选一即可" class="headerlink" title="官方!!!–&gt;支持HTTP推送  以下操作2选一即可"></a><a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/registry/insecure/">官方!!!–&gt;支持HTTP推送<i class="fas fa-external-link-alt"></i></a> 以下操作2选一即可</h2><ol><li><h2 id="修改”执行推送镜像的机器”的-etc-default-docker文件"><a href="#修改”执行推送镜像的机器”的-etc-default-docker文件" class="headerlink" title="修改”执行推送镜像的机器”的/etc/default/docker文件"></a>修改”执行推送镜像的机器”的<code>/etc/default/docker</code>文件</h2>在<code>DOCKER_OPTS</code>中添加<code>--insecure-registry</code>选项。<blockquote><h2 id="DOCKER-OPTS-”–insecure-registry-192-168-11-148-5000”"><a href="#DOCKER-OPTS-”–insecure-registry-192-168-11-148-5000”" class="headerlink" title="DOCKER_OPTS=”–insecure-registry 192.168.11.148:5000”"></a>DOCKER_OPTS=”–insecure-registry 192.168.11.148:5000”</h2><p>Reference</p></blockquote><ul><li><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/boling_cavalry/article/details/78818462">docker私有仓库搭建与使用实战<i class="fas fa-external-link-alt"></i></a></li></ul></li><li><h2 id="修改”执行推送镜像的机器”的-etc-docker-daemon-json文件"><a href="#修改”执行推送镜像的机器”的-etc-docker-daemon-json文件" class="headerlink" title="修改”执行推送镜像的机器”的/etc/docker/daemon.json文件"></a>修改”执行推送镜像的机器”的<code>/etc/docker/daemon.json</code>文件</h2>添加以下配置<blockquote><p>{<br><br>“insecure-registries” : [“myregistrydomain.com:5000”]<br><br>}</p></blockquote></li></ol></li><li><h2 id="验证推送-amp-删除镜像-amp-私服存储回收"><a href="#验证推送-amp-删除镜像-amp-私服存储回收" class="headerlink" title="验证推送 &amp; 删除镜像 &amp; 私服存储回收"></a>验证推送 &amp; 删除镜像 &amp; 私服存储回收</h2><h2 id="Docker-Registry之删除镜像、垃圾回收"><a href="#Docker-Registry之删除镜像、垃圾回收" class="headerlink" title="Docker Registry之删除镜像、垃圾回收"></a><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/u010884123/article/details/56838644">Docker Registry之删除镜像、垃圾回收<i class="fas fa-external-link-alt"></i></a></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ---------------------------------------------------</span></span><br><span class="line"><span class="comment"># 查看私服镜像所有仓库</span></span><br><span class="line">curl -X GET http://192.168.11.148:5000/v2/_catalog</span><br><span class="line"></span><br><span class="line"><span class="comment"># RESULT是</span></span><br><span class="line"><span class="comment"># &#123;&quot;repositories&quot;:[&quot;com.emapgo.webtools/emg-gps2road&quot;,&quot;com.emapgo.webtools/emg-gps2road-21111&quot;,&quot;com.emapgo.webtools/emg-road-maching&quot;,&quot;nginx&quot;]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------</span></span><br><span class="line"><span class="comment"># 查看指定仓库中镜像的所有标签列表</span></span><br><span class="line">curl http://localhost:5000/v2/com.emapgo.webtools/emg-road-matching-unit/tags/list</span><br><span class="line"><span class="comment"># RESULT是</span></span><br><span class="line"><span class="comment"># &#123;&quot;name&quot;:&quot;com.emapgo.webtools/emg-gps2road&quot;,&quot;tags&quot;:[&quot;20180911-2344&quot;,&quot;20180911-2327&quot;]&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------</span></span><br><span class="line"><span class="comment"># 查看镜像的SHA编码</span></span><br><span class="line">curl --header <span class="string">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span> -I -X HEAD  http://localhost:5000/v2/com.emapgo.webtools/emg-gps2road/manifests/20180911-2327</span><br><span class="line"></span><br><span class="line"><span class="comment"># RESULT是</span></span><br><span class="line"><span class="comment"># HTTP/1.1 200 OK</span></span><br><span class="line"><span class="comment"># Content-Length: 1159</span></span><br><span class="line"><span class="comment"># Content-Type: application/vnd.docker.distribution.manifest.v2+json</span></span><br><span class="line"><span class="comment"># Docker-Content-Digest: sha256:1994b8fd4a43fe736379c1bf36df6155dee80f80dc8dabc22c8a25a6ae61c524</span></span><br><span class="line"><span class="comment"># Docker-Distribution-Api-Version: registry/2.0</span></span><br><span class="line"><span class="comment"># Etag: &quot;sha256:1994b8fd4a43fe736379c1bf36df6155dee80f80dc8dabc22c8a25a6ae61c524&quot;</span></span><br><span class="line"><span class="comment"># X-Content-Type-Options: nosniff</span></span><br><span class="line"><span class="comment"># Date: Wed, 19 Sep 2018 09:42:44 GMT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------</span></span><br><span class="line"><span class="comment"># 根据镜像的SHA编码删除</span></span><br><span class="line"><span class="comment"># docker registry v2镜像删除问题 http://dockone.io/question/883</span></span><br><span class="line"><span class="comment"># https://docs.docker.com/registry/configuration/#delete</span></span><br><span class="line"><span class="comment"># https://github.com/docker/distribution/issues/1755</span></span><br><span class="line">curl --header <span class="string">&quot;Accept: application/vnd.docker.distribution.manifest.v2+json&quot;</span> -I -X DELETE http://localhost:5000/v2/com.emapgo.webtools/emg-gps2road/manifests/sha256:1994b8fd4a43fe736379c1bf36df6155dee80f80dc8dabc22c8a25a6ae61c524</span><br><span class="line"></span><br><span class="line"><span class="comment"># RESULT是</span></span><br><span class="line"><span class="comment"># HTTP/1.1 202 Accepted</span></span><br><span class="line"><span class="comment"># Docker-Distribution-Api-Version: registry/2.0</span></span><br><span class="line"><span class="comment"># X-Content-Type-Options: nosniff</span></span><br><span class="line"><span class="comment"># Date: Wed, 19 Sep 2018 10:32:55 GMT</span></span><br><span class="line"><span class="comment"># Content-Length: 0</span></span><br><span class="line"><span class="comment"># Content-Type: text/plain; charset=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ---------------------------------------------------</span></span><br><span class="line"><span class="comment"># 登入Rgistry容器中，手动执行GC</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line">registry garbage-collect /etc/docker/registry/config.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># com.emapgo.webtools/emg-road-maching</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 0 blobs marked, 6 blobs eligible for deletion</span></span><br><span class="line"><span class="comment"># blob eligible for deletion: sha256:4dec889989158cfe44dd849404b608adc81b77d40dde4cfbbfb79b5ad19d555f</span></span><br><span class="line"><span class="comment"># INFO[0000] Deleting blob: /docker/registry/v2/blobs/sha256/4d/4dec889989158cfe44dd849404b608adc81b77d40dde4cfbbfb79b5ad19d555f  go.version=go1.7.6 instance.id=86472ef4-cbe9-402d-b0f9-c316cb1b6520</span></span><br><span class="line"><span class="comment"># blob eligible for deletion: sha256:80c25b7e741b44f5fbe32ea548b5bc3c49b59cde87cb61dfb823b8606b3b82a0</span></span><br><span class="line"><span class="comment"># INFO[0000] Deleting blob: /docker/registry/v2/blobs/sha256/80/80c25b7e741b44f5fbe32ea548b5bc3c49b59cde87cb61dfb823b8606b3b82a0  go.version=go1.7.6 instance.id=86472ef4-cbe9-402d-b0f9-c316cb1b6520</span></span><br><span class="line"><span class="comment"># blob eligible for deletion: sha256:8e3ba11ec2a2b39ab372c60c16b421536e50e5ce64a0bc81765c2e38381bcff6</span></span><br><span class="line"><span class="comment"># INFO[0000] Deleting blob: /docker/registry/v2/blobs/sha256/8e/8e3ba11ec2a2b39ab372c60c16b421536e50e5ce64a0bc81765c2e38381bcff6  go.version=go1.7.6 instance.id=86472ef4-cbe9-402d-b0f9-c316cb1b6520</span></span><br><span class="line"><span class="comment"># blob eligible for deletion: sha256:95bfa58d9ddeb41c83562155f274d576bf20cb4f0a04b589e5dac73a826705d7</span></span><br><span class="line"><span class="comment"># INFO[0000] Deleting blob: /docker/registry/v2/blobs/sha256/95/95bfa58d9ddeb41c83562155f274d576bf20cb4f0a04b589e5dac73a826705d7  go.version=go1.7.6 instance.id=86472ef4-cbe9-402d-b0f9-c316cb1b6520</span></span><br><span class="line"><span class="comment"># blob eligible for deletion: sha256:aa47ae0743573e4c0476a6b3c0db4a5c976832355c2f6c4a47742a278e30b415</span></span><br><span class="line"><span class="comment"># INFO[0000] Deleting blob: /docker/registry/v2/blobs/sha256/aa/aa47ae0743573e4c0476a6b3c0db4a5c976832355c2f6c4a47742a278e30b415  go.version=go1.7.6 instance.id=86472ef4-cbe9-402d-b0f9-c316cb1b6520</span></span><br><span class="line"><span class="comment"># blob eligible for deletion: sha256:2146c373b4668ab06b15e7bed7d009c501c752b3de4c71491e4fc1a4b5d4d71a</span></span><br><span class="line"><span class="comment"># INFO[0000] Deleting blob: /docker/registry/v2/blobs/sha256/21/2146c373b4668ab06b15e7bed7d009c501c752b3de4c71491e4fc1a4b5d4d71a  go.version=go1.7.6 instance.id=86472ef4-cbe9-402d-b0f9-c316cb1b6520</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ol></li><li><h2 id="Docker-Registry镜像清理问题"><a href="#Docker-Registry镜像清理问题" class="headerlink" title="Docker Registry镜像清理问题"></a><a class="link" target="_blank" rel="noopener" href="https://ningyu1.github.io/site/post/46-docker-registry/">Docker Registry镜像清理问题<i class="fas fa-external-link-alt"></i></a></h2></li><li><h2 id="删除以及删除所有数据"><a href="#删除以及删除所有数据" class="headerlink" title="删除以及删除所有数据"></a><font color="red">删除以及删除所有数据</font></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Now stop your registry and remove all data</span></span><br><span class="line">docker container stop registry &amp;&amp; docker container rm -v registry</span><br></pre></td></tr></table></figure></li><li><h2 id="私有镜像服务器的WEB-UI"><a href="#私有镜像服务器的WEB-UI" class="headerlink" title="私有镜像服务器的WEB UI"></a>私有镜像服务器的WEB UI</h2><ol><li><h2 id="hyper-docker-registry-web"><a href="#hyper-docker-registry-web" class="headerlink" title="hyper/docker-registry-web"></a><a class="link" target="_blank" rel="noopener" href="https://hub.docker.com/r/hyper/docker-registry-web/">hyper/docker-registry-web<i class="fas fa-external-link-alt"></i></a></h2><blockquote><h2 id="config-yml的内容如下"><a href="#config-yml的内容如下" class="headerlink" title="config.yml的内容如下"></a>config.yml的内容如下</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">registry:</span></span><br><span class="line">    <span class="comment"># Docker registry url</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">http://registry2:5000/v2</span></span><br><span class="line">    <span class="comment"># Docker registry fqdn</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">localhost:5000</span></span><br><span class="line">    <span class="comment"># To allow image delete, should be false</span></span><br><span class="line">    <span class="attr">readonly:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">auth:</span></span><br><span class="line">      <span class="comment"># Disable authentication</span></span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">false</span></span><br></pre></td></tr></table></figure><h2 id="run-registry-web-sh的内容如下，该SH脚本需要与config-yml同级目录"><a href="#run-registry-web-sh的内容如下，该SH脚本需要与config-yml同级目录" class="headerlink" title="run-registry-web.sh的内容如下，该SH脚本需要与config.yml同级目录"></a>run-registry-web.sh的内容如下，该SH脚本需要与config.yml同级目录</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">docker run -it -p 18080:8080 --name registry-web --link registry2 -v $(<span class="built_in">pwd</span>)/config.yml:/conf/config.yml:ro hyper/docker-registry-web</span><br></pre></td></tr></table></figure><h2 id="虽然可以删除镜像了，但是GC还是需要登陆到Registry2容器中手动执行命令registry-garbage-collect-etc-docker-registry-config-yml"><a href="#虽然可以删除镜像了，但是GC还是需要登陆到Registry2容器中手动执行命令registry-garbage-collect-etc-docker-registry-config-yml" class="headerlink" title="虽然可以删除镜像了，但是GC还是需要登陆到Registry2容器中手动执行命令registry garbage-collect /etc/docker/registry/config.yml"></a><font color="red">虽然可以删除镜像了，但是GC还是需要登陆到Registry2容器中手动执行命令<code>registry garbage-collect /etc/docker/registry/config.yml</code></font></h2></blockquote></li><li><h2 id="docker-registry-frontend"><a href="#docker-registry-frontend" class="headerlink" title="docker-registry-frontend"></a><a class="link" target="_blank" rel="noopener" href="https://hub.docker.com/r/konradkleine/docker-registry-frontend/">docker-registry-frontend<i class="fas fa-external-link-alt"></i></a></h2></li></ol></li></ol></li><li><h2 id="Swarm–-gt-必看-Getting-started-with-swarm-mode-amp-Deploy-services-to-a-swarm"><a href="#Swarm–-gt-必看-Getting-started-with-swarm-mode-amp-Deploy-services-to-a-swarm" class="headerlink" title="Swarm–&gt;必看(Getting started with swarm mode &amp; Deploy services to a swarm)"></a>Swarm–&gt;<font color="red">必看(<a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/swarm-tutorial/">Getting started with swarm mode<i class="fas fa-external-link-alt"></i></a> &amp; <a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/services/">Deploy services to a swarm<i class="fas fa-external-link-alt"></i></a>)</font></h2><ol><li><h2 id="Swarm各个节点状态"><a href="#Swarm各个节点状态" class="headerlink" title="Swarm各个节点状态"></a>Swarm各个节点状态</h2><ol><li><h2 id="RAFT协议"><a href="#RAFT协议" class="headerlink" title="RAFT协议"></a><font color="red"><a class="link" target="_blank" rel="noopener" href="http://thesecretlivesofdata.com/raft/">RAFT协议<i class="fas fa-external-link-alt"></i></a></font></h2></li><li><h2 id="节点的角色"><a href="#节点的角色" class="headerlink" title="节点的角色"></a>节点的角色</h2><ol><li><h2 id="Leader-swarn集群中至少得有2个可用的被选举节点才能选举主节点出来，否则集群将无法执行操作"><a href="#Leader-swarn集群中至少得有2个可用的被选举节点才能选举主节点出来，否则集群将无法执行操作" class="headerlink" title="Leader [swarn集群中至少得有2个可用的被选举节点才能选举主节点出来，否则集群将无法执行操作]"></a>Leader <font color="yellow">[swarn集群中至少得有2个可用的被选举节点才能选举主节点出来，否则集群将无法执行操作]</font></h2></li><li><h2 id="Manager"><a href="#Manager" class="headerlink" title="Manager"></a>Manager</h2></li><li><h2 id="Worker"><a href="#Worker" class="headerlink" title="Worker"></a>Worker</h2></li></ol></li><li><h2 id="针对角色的操作"><a href="#针对角色的操作" class="headerlink" title="针对角色的操作"></a>针对角色的操作</h2><ol><li><h2 id="promote-提升权限，但是不能直接提升为Leader"><a href="#promote-提升权限，但是不能直接提升为Leader" class="headerlink" title="promote 提升权限，但是不能直接提升为Leader"></a>promote 提升权限，但是不能直接提升为Leader</h2></li><li><h2 id="demote-降低权限"><a href="#demote-降低权限" class="headerlink" title="demote 降低权限"></a>demote 降低权限</h2></li></ol></li><li><h2 id="节点的状态"><a href="#节点的状态" class="headerlink" title="节点的状态"></a>节点的状态</h2><ol><li><h2 id="Active"><a href="#Active" class="headerlink" title="Active"></a>Active</h2></li><li><h2 id="Drain"><a href="#Drain" class="headerlink" title="Drain"></a>Drain</h2></li></ol></li><li><h2 id="管理节点和worker节点的比例"><a href="#管理节点和worker节点的比例" class="headerlink" title="管理节点和worker节点的比例"></a><a class="link" target="_blank" rel="noopener" href="http://blog.51cto.com/nginxs/1903230">管理节点和worker节点的比例<i class="fas fa-external-link-alt"></i></a></h2><blockquote><h2 id="manager节点可以损坏几个而不影响？"><a href="#manager节点可以损坏几个而不影响？" class="headerlink" title="manager节点可以损坏几个而不影响？"></a>manager节点可以损坏几个而不影响？</h2><h2 id="简单的说你至少有两个manager节点才可以进行选举-为了利用群模式的容错功能，Docker建议您根据组织的高可用性要求实现奇数个节点。当有多个manager时，您可以manager节点的故障中恢复，而无需停机。"><a href="#简单的说你至少有两个manager节点才可以进行选举-为了利用群模式的容错功能，Docker建议您根据组织的高可用性要求实现奇数个节点。当有多个manager时，您可以manager节点的故障中恢复，而无需停机。" class="headerlink" title="简单的说你至少有两个manager节点才可以进行选举.为了利用群模式的容错功能，Docker建议您根据组织的高可用性要求实现奇数个节点。当有多个manager时，您可以manager节点的故障中恢复，而无需停机。"></a>简单的说你至少有两个manager节点才可以进行选举.为了利用群模式的容错功能，Docker建议您根据组织的高可用性要求实现奇数个节点。当有多个manager时，您可以manager节点的故障中恢复，而无需停机。</h2><ul><li><h2 id="三个manager容忍一个manager的最大损失。"><a href="#三个manager容忍一个manager的最大损失。" class="headerlink" title="三个manager容忍一个manager的最大损失。"></a>三个manager容忍一个manager的最大损失。</h2></li><li><h2 id="五manager容忍两个manager节点的最大同时丢失。"><a href="#五manager容忍两个manager节点的最大同时丢失。" class="headerlink" title="五manager容忍两个manager节点的最大同时丢失。"></a>五manager容忍两个manager节点的最大同时丢失。</h2></li><li><h2 id="N个manager集群将容忍最多（N-1）-2个manager的丢失。"><a href="#N个manager集群将容忍最多（N-1）-2个manager的丢失。" class="headerlink" title="N个manager集群将容忍最多（N-1）/ 2个manager的丢失。"></a>N个manager集群将容忍最多（N-1）/ 2个manager的丢失。</h2></li><li><h2 id="Docker建议一个群集最多有七个manager节点。重要说明：添加更多manager并不意味着增加可伸缩性或更高的性能。一般来说，情况恰恰相反。"><a href="#Docker建议一个群集最多有七个manager节点。重要说明：添加更多manager并不意味着增加可伸缩性或更高的性能。一般来说，情况恰恰相反。" class="headerlink" title="Docker建议一个群集最多有七个manager节点。重要说明：添加更多manager并不意味着增加可伸缩性或更高的性能。一般来说，情况恰恰相反。"></a>Docker建议一个群集最多有七个manager节点。<font color="red">重要说明：添加更多manager并不意味着增加可伸缩性或更高的性能。一般来说，情况恰恰相反。</font></h2></li></ul></blockquote></li></ol></li><li><h2 id="初始化Swarm"><a href="#初始化Swarm" class="headerlink" title="初始化Swarm"></a>初始化Swarm</h2><blockquote><h2 id="SWARM集群保持节点间通信畅通-Open-protocols-and-ports-between-the-hosts"><a href="#SWARM集群保持节点间通信畅通-Open-protocols-and-ports-between-the-hosts" class="headerlink" title="SWARM集群保持节点间通信畅通 Open protocols and ports between the hosts"></a><font color="red">SWARM集群保持节点间通信畅通 Open protocols and ports between the hosts</font></h2><h3 id="The-following-ports-must-be-available-On-some-systems-these-ports-are-open-by-default"><a href="#The-following-ports-must-be-available-On-some-systems-these-ports-are-open-by-default" class="headerlink" title="The following ports must be available. On some systems, these ports are open by default."></a>The following ports must be available. On some systems, these ports are open by default.</h3><h3 id="TCP-port-2377-for-cluster-management-communications"><a href="#TCP-port-2377-for-cluster-management-communications" class="headerlink" title="TCP port 2377 for cluster management communications"></a>TCP port 2377 for cluster management communications</h3><h3 id="TCP-and-UDP-port-7946-for-communication-among-nodes"><a href="#TCP-and-UDP-port-7946-for-communication-among-nodes" class="headerlink" title="TCP and UDP port 7946 for communication among nodes"></a>TCP and UDP port 7946 for communication among nodes</h3><h3 id="UDP-port-4789-for-overlay-network-traffic"><a href="#UDP-port-4789-for-overlay-network-traffic" class="headerlink" title="UDP port 4789 for overlay network traffic"></a>UDP port 4789 for overlay network traffic</h3><h3 id="If-you-plan-on-creating-an-overlay-network-with-encryption-–opt-encrypted-you-also-need-to-ensure-ip-protocol-50-ESP-traffic-is-allowed"><a href="#If-you-plan-on-creating-an-overlay-network-with-encryption-–opt-encrypted-you-also-need-to-ensure-ip-protocol-50-ESP-traffic-is-allowed" class="headerlink" title="If you plan on creating an overlay network with encryption (–opt encrypted), you also need to ensure ip protocol 50 (ESP) traffic is allowed."></a>If you plan on creating an overlay network with encryption (–opt encrypted), you also need to ensure ip protocol 50 (ESP) traffic is allowed.</h3><hr><h2 id="docker-swarm-mode的服务发现和LB详解"><a href="#docker-swarm-mode的服务发现和LB详解" class="headerlink" title="docker swarm mode的服务发现和LB详解"></a><a class="link" target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/25954203">docker swarm mode的服务发现和LB详解<i class="fas fa-external-link-alt"></i></a></h2><h3 id="Ingress-LB可以将容器网络中的服务暴露到宿主机网络中，从而被外部所访问。"><a href="#Ingress-LB可以将容器网络中的服务暴露到宿主机网络中，从而被外部所访问。" class="headerlink" title="Ingress LB可以将容器网络中的服务暴露到宿主机网络中，从而被外部所访问。"></a><font color="yellow">Ingress LB可以将容器网络中的服务暴露到宿主机网络中，从而被外部所访问。</font></h3><h3 id="Swarm-mode下，docker会创建一个默认的overlay网络—ingress-network。Docker也会为每个worker节点创建一个特殊的net-namespace（sandbox）–-ingress-sbox。ingress-sbox有两个endpoint，一个用于连接ingress-network，另一个用于连接local-bridge-network-–-docker-gwbridge。Ingress-network的IP空间为10-255-0-0-16，所有router-mesh的service都共用此空间。"><a href="#Swarm-mode下，docker会创建一个默认的overlay网络—ingress-network。Docker也会为每个worker节点创建一个特殊的net-namespace（sandbox）–-ingress-sbox。ingress-sbox有两个endpoint，一个用于连接ingress-network，另一个用于连接local-bridge-network-–-docker-gwbridge。Ingress-network的IP空间为10-255-0-0-16，所有router-mesh的service都共用此空间。" class="headerlink" title="Swarm mode下，docker会创建一个默认的overlay网络—ingress network。Docker也会为每个worker节点创建一个特殊的net namespace（sandbox）– ingress_sbox。ingress_sbox有两个endpoint，一个用于连接ingress network，另一个用于连接local bridge network – docker_gwbridge。Ingress network的IP空间为10.255.0.0/16，所有router mesh的service都共用此空间。"></a>Swarm mode下，docker会创建一个默认的overlay网络—ingress network。Docker也会为每个worker节点创建一个特殊的net namespace（sandbox）– ingress_sbox。ingress_sbox有两个endpoint，一个用于连接ingress network，另一个用于连接local bridge network – docker_gwbridge。Ingress network的IP空间为10.255.0.0/16，所有router mesh的service都共用此空间。</h3><h3 id="Ingress-LB分别在1）节点iptables，2）ingress-sbox的iptables和ipvs，3）service容器的iptables处设置相应规则，从而可以在宿主机网络上通过宿主机IP和published端口来访问容器网络的服务。"><a href="#Ingress-LB分别在1）节点iptables，2）ingress-sbox的iptables和ipvs，3）service容器的iptables处设置相应规则，从而可以在宿主机网络上通过宿主机IP和published端口来访问容器网络的服务。" class="headerlink" title="Ingress LB分别在1）节点iptables，2）ingress_sbox的iptables和ipvs，3）service容器的iptables处设置相应规则，从而可以在宿主机网络上通过宿主机IP和published端口来访问容器网络的服务。"></a>Ingress LB分别在1）节点iptables，2）ingress_sbox的iptables和ipvs，3）service容器的iptables处设置相应规则，从而可以在宿主机网络上通过宿主机IP和published端口来访问容器网络的服务。</h3><hr><h2 id="api-additions-for-host-level-port-publishing-1645"><a href="#api-additions-for-host-level-port-publishing-1645" class="headerlink" title="api: additions for host-level port publishing #1645"></a><a class="link" target="_blank" rel="noopener" href="https://github.com/docker/swarmkit/pull/1645">api: additions for host-level port publishing #1645<i class="fas fa-external-link-alt"></i></a></h2><h2 id="端口暴露PUBLISH-A-SERVICE’S-PORTS-DIRECTLY-ON-THE-SWARM-NODE"><a href="#端口暴露PUBLISH-A-SERVICE’S-PORTS-DIRECTLY-ON-THE-SWARM-NODE" class="headerlink" title="端口暴露PUBLISH A SERVICE’S PORTS DIRECTLY ON THE SWARM NODE"></a><font color="yellow">端口暴露</font><a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/engine/swarm/services/#publish-a-services-ports-directly-on-the-swarm-node">PUBLISH A SERVICE’S PORTS DIRECTLY ON THE SWARM NODE<i class="fas fa-external-link-alt"></i></a></h2><hr><h2 id="Networking-mode-net-host-in-docker-stack-file-not-working-33393"><a href="#Networking-mode-net-host-in-docker-stack-file-not-working-33393" class="headerlink" title="Networking mode (net: host) in docker stack file not working #33393"></a><a class="link" target="_blank" rel="noopener" href="https://github.com/moby/moby/issues/33393">Networking mode (net: host) in docker stack file not working #33393<i class="fas fa-external-link-alt"></i></a></h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">      <span class="string">&gt;version:</span> <span class="string">&quot;3.2&quot;</span> </span><br><span class="line">      <span class="string">&gt;services:</span></span><br><span class="line"><span class="attr">master:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">tomcat:8.5-jre8-alpine</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">80</span></span><br><span class="line">      <span class="attr">published:</span> <span class="number">8080</span></span><br><span class="line">      <span class="attr">protocol:</span> <span class="string">tcp</span></span><br><span class="line">      <span class="attr">mode:</span> <span class="string">host</span></span><br></pre></td></tr></table></figure><h2 id="如果按照以上配置，要求version的版本必须大于等于3-2"><a href="#如果按照以上配置，要求version的版本必须大于等于3-2" class="headerlink" title="如果按照以上配置，要求version的版本必须大于等于3.2"></a>如果按照以上配置，要求<code>version</code>的版本必须大于等于3.2</h2><hr></blockquote><p>docker service create –name tomcat –mode global –publish mode=host,target=8080,published=8080 tomcat:latest</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在master节点执行初始化集群</span></span><br><span class="line"><span class="comment"># 如果机器有多个网卡，请使用 --advertise-addr 参数指定 IP</span></span><br><span class="line">docker swarm init --advertise-addr 192.168.40.91 --listen-addr 192.168.40.91:2377 </span><br></pre></td></tr></table></figure></li><li><h2 id="节点角色转变"><a href="#节点角色转变" class="headerlink" title="节点角色转变"></a>节点角色转变</h2><blockquote><p>节点的manager和worker的角色是可以转变的, 只需进入到worker的终端，执行：<code>sudo docker node promote</code>就可以完成角色的转变</p></blockquote></li><li><h2 id="忘记swarm的token"><a href="#忘记swarm的token" class="headerlink" title="忘记swarm的token"></a>忘记swarm的token</h2><blockquote><p>如果忘了<code>docker swarm join</code> 命令中的token命令的话，可以使用命令<code>docker swarm join-token worker</code>来得到Worker角色的Token，而使用<code>docker swarm join-token manager</code>得到Manager角色的token</p></blockquote></li><li><h2 id="加入Swarm-as-Worker"><a href="#加入Swarm-as-Worker" class="headerlink" title="加入Swarm as Worker"></a>加入Swarm as Worker</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-0fuenw4bykkpkmqdrng1y5qh0upl3oz3lnkk7wtqez86rdi7f1-cw8o1yeetmx9qhj64i5h2yiwo 192.168.40.91:2377 --listen-addr 192.168.40.XX:2377 --advertise-addr 192.168.40.XX</span><br></pre></td></tr></table></figure></li><li><h2 id="加入Swarm-as-Manager"><a href="#加入Swarm-as-Manager" class="headerlink" title="加入Swarm as Manager"></a>加入Swarm as Manager</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker swarm join --token SWMTKN-1-0fuenw4bykkpkmqdrng1y5qh0upl3oz3lnkk7wtqez86rdi7f1-dr8jg86gkby6cicws9k9p3xsp 192.168.40.91:2377 --listen-addr 192.168.40.XX:2377 --advertise-addr 192.168.40.XX</span><br></pre></td></tr></table></figure></li><li><h2 id="添加删除Node-Labels："><a href="#添加删除Node-Labels：" class="headerlink" title="添加删除Node Labels："></a>添加删除Node Labels：</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker node update [option] [nodeName]</span><br></pre></td></tr></table></figure><blockquote><p>[option]:label-add [key=value] # 以键值对的方式添加label<br><br>label-rm [key] # 移除指定键的label<br><br>[nodeName] # Docker swarm 集群创建时该节点所取的节点名<br><br>例子：<code>sudo docker node update --label-add workrole=db 8i9kx483onfxdktd4mmme39ea</code></p></blockquote></li><li><h2 id="Swarm中删除节点和服务"><a href="#Swarm中删除节点和服务" class="headerlink" title="Swarm中删除节点和服务"></a>Swarm中删除节点和服务</h2><ol><li><h2 id="删除swam节点"><a href="#删除swam节点" class="headerlink" title="删除swam节点"></a>删除swam节点</h2><blockquote><h2 id="确实想要从swarm集群中删除，你应该先把这个节点容器排空，然后再把节点从集群中去掉-排空节点（其实就是把这个节点上的容器先从其它节点启动，再停掉排空节点上的容器，保证你定义服务的预先状态不受影响）"><a href="#确实想要从swarm集群中删除，你应该先把这个节点容器排空，然后再把节点从集群中去掉-排空节点（其实就是把这个节点上的容器先从其它节点启动，再停掉排空节点上的容器，保证你定义服务的预先状态不受影响）" class="headerlink" title="确实想要从swarm集群中删除，你应该先把这个节点容器排空，然后再把节点从集群中去掉, 排空节点（其实就是把这个节点上的容器先从其它节点启动，再停掉排空节点上的容器，保证你定义服务的预先状态不受影响）."></a>确实想要从swarm集群中删除，你应该先把这个节点容器排空，然后再把节点从集群中去掉, 排空节点（其实就是把这个节点上的容器先从其它节点启动，再停掉排空节点上的容器，保证你定义服务的预先状态不受影响）.</h2></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 排空节点</span></span><br><span class="line">docker node update --availability drain 节点ID</span><br><span class="line"><span class="comment"># 删除节点</span></span><br><span class="line">docker node rm 节点ID</span><br><span class="line">docker node rm --force 节点ID</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 从排空中恢复</span></span><br><span class="line">docker node update --availability Active 节点ID</span><br></pre></td></tr></table></figure></li><li><h2 id="删除后重新加入集群"><a href="#删除后重新加入集群" class="headerlink" title="删除后重新加入集群"></a>删除后重新加入集群</h2><blockquote><h2 id="如果节点自身主动退出集群，manager也需要从集群删除节点，否则在进入时重复加入集群报错"><a href="#如果节点自身主动退出集群，manager也需要从集群删除节点，否则在进入时重复加入集群报错" class="headerlink" title="如果节点自身主动退出集群，manager也需要从集群删除节点，否则在进入时重复加入集群报错"></a>如果节点自身主动退出集群，manager也需要从集群删除节点，否则在进入时重复加入集群报错</h2></blockquote></li></ol></li><li><h2 id="节点离开SWARM集群-危险操作"><a href="#节点离开SWARM集群-危险操作" class="headerlink" title="节点离开SWARM集群[危险操作]"></a><font color="red">节点离开SWARM集群[危险操作]</font></h2><ol><li><h2 id="离开swarm集群（离开后发现在manager里面这个节点是down的状态，当然这状态变化是有延时的，因为需要迁移容器）"><a href="#离开swarm集群（离开后发现在manager里面这个节点是down的状态，当然这状态变化是有延时的，因为需要迁移容器）" class="headerlink" title="离开swarm集群（离开后发现在manager里面这个节点是down的状态，当然这状态变化是有延时的，因为需要迁移容器）"></a>离开swarm集群（离开后发现在manager里面这个节点是down的状态，当然这状态变化是有延时的，因为需要迁移容器）</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在将要离开的节点上操作</span></span><br><span class="line">docker swarm leave</span><br><span class="line"><span class="comment"># 强制离开swarm集群(在将要离开的节点上操作)</span></span><br><span class="line">docker swarm leave --force</span><br></pre></td></tr></table></figure></li></ol></li></ol></li><li><h2 id="分布"><a href="#分布" class="headerlink" title="分布"></a>分布</h2><ol><li><h2 id="查询Swarm相关信息"><a href="#查询Swarm相关信息" class="headerlink" title="查询Swarm相关信息"></a>查询Swarm相关信息</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示swarm的对应IP、Role、Labels</span></span><br><span class="line">sudo docker node ls -q | xargs sudo docker node inspect -f <span class="string">&#x27;&#123;&#123; .ID &#125;&#125; &#123;&#123;.Status.Addr&#125;&#125; &#123;&#123;.Spec.Role&#125;&#125; [&#123;&#123; .Description.Hostname &#125;&#125;]: &#123;&#123; range $k, $v := .Spec.Labels &#125;&#125;&#123;&#123; $k &#125;&#125;=&#123;&#123; $v &#125;&#125; &#123;&#123;end&#125;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><blockquote><p>Reference<br><a class="link" target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/node_inspect/#inspect-a-node">docker node inspect -f<i class="fas fa-external-link-alt"></i></a></p></blockquote></li><li><h2 id="环境分布状况"><a href="#环境分布状况" class="headerlink" title="环境分布状况"></a>环境分布状况</h2><table><thead><tr><th>id</th><th>ip</th><th>role</th><th>host</th><th>label</th></tr></thead><tbody><tr><td>1gffezqax8bq01dnea1ayizy3</td><td>192.168.40.73</td><td>worker</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr><tr><td>8i9kx483onfxdktd4mmme39ea</td><td><font color="red">192.168.40.91</font></td><td>manager<font color="red">[leader]</font></td><td>[emg]</td><td>consulrole=leader<br>workrole=db</td></tr><tr><td>gvg6uhtju5slns1jqh59skzo2</td><td>192.168.40.52</td><td>manager</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr><tr><td>jxrh0igseibb9rxntpuh4gz81</td><td>192.168.40.74</td><td>worker</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr><tr><td>mixuwuyvvuomix64d9r8k1jwd</td><td>192.168.40.12</td><td>worker</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr><tr><td>nnunekxs8oy1b6azbc3wq6t70</td><td>192.168.40.51</td><td>manager</td><td>[emg]</td><td>consulrole=server<br>workrole=match</td></tr><tr><td>sy6qjwo0z73t0smmdqbcgtq0h</td><td>192.168.40.71</td><td>manager</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr><tr><td>u7n5wtci9upa042tpmgc0za73</td><td>192.168.40.11</td><td>manager</td><td>[emg]</td><td>consulrole=server<br>workrole=match</td></tr><tr><td>umgmjkfzddt49t71aeb6fu3s8</td><td>192.168.40.31</td><td>worker</td><td>[emg]</td><td>consulrole=server<br>workrole=match</td></tr><tr><td>uz8602ynb0rpx9t2l36jyhium</td><td>192.168.40.72</td><td>worker</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr><tr><td>wh6ii65oire5j9un54d6m5gjg</td><td>192.168.40.32</td><td>manager</td><td>[emg]</td><td>consulrole=client<br>workrole=match</td></tr></tbody></table></li></ol></li><li><h2 id="Swarm-Visualizer"><a href="#Swarm-Visualizer" class="headerlink" title="Swarm Visualizer"></a>Swarm Visualizer</h2><ol><li><h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><ul><li><h2 id="docker-swarm-visualizer"><a href="#docker-swarm-visualizer" class="headerlink" title="docker-swarm-visualizer"></a><a class="link" target="_blank" rel="noopener" href="https://github.com/dockersamples/docker-swarm-visualizer">docker-swarm-visualizer<i class="fas fa-external-link-alt"></i></a></h2></li></ul></li><li><h2 id="docker-compose"><a href="#docker-compose" class="headerlink" title="docker-compose"></a>docker-compose</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stack deploy -c docker-compose-visualizer.yml visualizer</span><br></pre></td></tr></table></figure><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">visualizer:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">dockersamples/visualizer:stable</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="number">20001</span><span class="string">:8080</span></span><br><span class="line">    <span class="attr">stop_grace_period:</span> <span class="string">1m30s</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;/var/run/docker.sock:/var/run/docker.sock&quot;</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">1</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> </span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.label.visualrole</span> <span class="string">==</span> <span class="string">visualizer</span></span><br></pre></td></tr></table></figure><blockquote><p>启动后，可在SWARM节点的任何IP上访问20001端口，显示集群运行状态</p></blockquote></li></ol></li><li><h2 id="实际部署APP演练"><a href="#实际部署APP演练" class="headerlink" title="实际部署APP演练"></a>实际部署APP演练</h2><ol><li><h2 id="创建外部网络"><a href="#创建外部网络" class="headerlink" title="创建外部网络"></a>创建外部网络</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在Leader节点创建外部overlay</span></span><br><span class="line">sudo docker network create -d overlay bigdata_net</span><br></pre></td></tr></table></figure></li><li><h2 id="具体应用的docker-compose-yml"><a href="#具体应用的docker-compose-yml" class="headerlink" title="具体应用的docker-compose.yml"></a>具体应用的docker-compose.yml</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">macthnet:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="number">192.168</span><span class="number">.11</span><span class="number">.148</span><span class="string">:5000/com.emapgo.webtools/emg-gps2road-21111:20180915-2321</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">match-service</span></span><br><span class="line">    <span class="attr">deploy:</span></span><br><span class="line">      <span class="attr">replicas:</span> <span class="number">6</span></span><br><span class="line">      <span class="attr">restart_policy:</span></span><br><span class="line">        <span class="attr">condition:</span> <span class="string">on-failure</span></span><br><span class="line">      <span class="attr">placement:</span></span><br><span class="line">        <span class="attr">constraints:</span> </span><br><span class="line">          <span class="bullet">-</span> <span class="string">node.labels.workrole</span> <span class="string">==</span> <span class="string">match</span> </span><br><span class="line">    <span class="attr">ports:</span> </span><br><span class="line">      <span class="comment"># - &quot;21111:21111&quot; # 这种映射方式不会被Registrator识别到</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">target:</span> <span class="number">21111</span></span><br><span class="line">        <span class="attr">published:</span> <span class="number">21111</span></span><br><span class="line">        <span class="attr">protocol:</span> <span class="string">tcp</span> <span class="comment">#实际部署时候没有采用</span></span><br><span class="line">        <span class="attr">mode:</span> <span class="string">host</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">bigdata_net</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">bigdata_net:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li><li><h2 id="部署命令"><a href="#部署命令" class="headerlink" title="部署命令"></a>部署命令</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker stack deploy -c 配置文件(docker-compose文件)位置 服务名称</span><br></pre></td></tr></table></figure></li><li><h2 id="查看以及删除服务"><a href="#查看以及删除服务" class="headerlink" title="查看以及删除服务"></a>查看以及删除服务</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看当前所有服务</span></span><br><span class="line">sudo docker service ls </span><br><span class="line"><span class="comment"># 查看具体服务状态</span></span><br><span class="line">sudo docker service ps 服务ID</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除服务</span></span><br><span class="line">sudo docker service rm 服务ID</span><br></pre></td></tr></table></figure><h2 id="Reference-1"><a href="#Reference-1" class="headerlink" title="Reference"></a>Reference</h2></li></ol></li><li><h3 id="Docker-Swarm-入门一篇文章就够了"><a href="#Docker-Swarm-入门一篇文章就够了" class="headerlink" title="Docker Swarm 入门一篇文章就够了"></a><a class="link" target="_blank" rel="noopener" href="https://www.jianshu.com/p/9eb9995884a5">Docker Swarm 入门一篇文章就够了<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="搭建Docker-Swarm集群实战-一-（服务发现使用consul）"><a href="#搭建Docker-Swarm集群实战-一-（服务发现使用consul）" class="headerlink" title="搭建Docker Swarm集群实战(一)（服务发现使用consul）"></a><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/leon_wzm/article/details/78164222">搭建Docker Swarm集群实战(一)（服务发现使用consul）<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="搭建Docker-Swarm集群实战-二-（服务发现使用consul）"><a href="#搭建Docker-Swarm集群实战-二-（服务发现使用consul）" class="headerlink" title="搭建Docker Swarm集群实战(二)（服务发现使用consul）"></a><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/leon_wzm/article/details/78170003">搭建Docker Swarm集群实战(二)（服务发现使用consul）<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="搭建Docker-Swarm集群实战-三-（swarm-mode）"><a href="#搭建Docker-Swarm集群实战-三-（swarm-mode）" class="headerlink" title="搭建Docker Swarm集群实战(三)（swarm mode）"></a><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/leon_wzm/article/details/78171174">搭建Docker Swarm集群实战(三)（swarm mode）<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="Docker-Swarm-Mode网络诊断工具"><a href="#Docker-Swarm-Mode网络诊断工具" class="headerlink" title="Docker Swarm Mode网络诊断工具"></a><a class="link" target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/421646">Docker Swarm Mode网络诊断工具<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="生产环境中使用Docker-Swarm的一些建议"><a href="#生产环境中使用Docker-Swarm的一些建议" class="headerlink" title="生产环境中使用Docker Swarm的一些建议"></a><a class="link" target="_blank" rel="noopener" href="https://yq.aliyun.com/articles/224957">生产环境中使用Docker Swarm的一些建议<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="Docker-Swarm集群初探"><a href="#Docker-Swarm集群初探" class="headerlink" title="Docker Swarm集群初探"></a><a class="link" target="_blank" rel="noopener" href="https://juejin.im/post/5a4eee9ff265da3e36410f02">Docker Swarm集群初探<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="Docker：Swarm-Stack-一站式部署容器集群"><a href="#Docker：Swarm-Stack-一站式部署容器集群" class="headerlink" title="Docker：Swarm + Stack 一站式部署容器集群"></a><a class="link" target="_blank" rel="noopener" href="https://blog.csdn.net/github_38705794/article/details/77541371">Docker：Swarm + Stack 一站式部署容器集群<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="随笔分类-Docker-by-Bigberg"><a href="#随笔分类-Docker-by-Bigberg" class="headerlink" title="随笔分类 - Docker by Bigberg"></a><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/bigberg/category/1132936.html">随笔分类 - Docker by Bigberg<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="Docker管理工具-Swarm-by-Bigberg"><a href="#Docker管理工具-Swarm-by-Bigberg" class="headerlink" title="Docker管理工具-Swarm by Bigberg"></a><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/bigberg/p/8761047.html">Docker管理工具-Swarm by Bigberg<i class="fas fa-external-link-alt"></i></a></h3></li><li><h3 id="Docker-Swarm集群部署-by-Bigberg"><a href="#Docker-Swarm集群部署-by-Bigberg" class="headerlink" title="Docker Swarm集群部署 by Bigberg"></a><a class="link" target="_blank" rel="noopener" href="https://www.cnblogs.com/bigberg/p/8761226.html">Docker Swarm集群部署 by Bigberg<i class="fas fa-external-link-alt"></i></a></h3></li></ol></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li>Post title：构建Docker Swarm Env</li><li>Post author：Raytheon Skywalker</li><li>Create time：2019-04-09 18:38:38</li><li>Post link：https://raytheon-skywalker.tech/2019/04/09/Use-docker-swarm-in-dev/</li><li>Copyright Notice：All articles in this blog are licensed under <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">BY-NC-SA</a> unless stating additionally.</li></ul></div></div><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2019/04/15/Displays-satellite-images-by-using-QGis/"><span class="left arrow-icon flex-center"><i class="fas fa-chevron-left"></i> </span><span class="title flex-center"><span class="post-nav-title-item">QGIS展示不同图商的卫片</span> <span class="post-nav-item">Prev posts</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2019/04/09/set-up-Ubuntu-based-dev-env/"><span class="title flex-center"><span class="post-nav-title-item">配置基于Ubuntu的Dev环境</span> <span class="post-nav-item">Next posts</span> </span><span class="right arrow-icon flex-center"><i class="fas fa-chevron-right"></i></span></a></div></div></div></div></div></div><div class="page-main-content-bottom"><footer class="footer"><div class="info-container"><div class="copyright-info info-item">&copy; <span>2020</span>&nbsp;-&nbsp; 2021&nbsp;<i class="fas fa-heart icon-animate"></i>&nbsp;<a href="/">Raytheon Skywalker</a></div><div class="theme-info info-item">Powered by <a target="_blank" href="https://hexo.io">Hexo</a>&nbsp;|&nbsp;Theme&nbsp;<a class="theme-version" target="_blank" href="https://github.com/XPoet/hexo-theme-keep">Keep v3.4.2</a></div></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="tools-list"><li class="tools-item page-aside-toggle"><i class="fas fa-outdent"></i></li></ul></div></div><div class="right-bottom-side-tools"><div class="side-tools-container"><ul class="side-tools-list"><li class="tools-item tool-font-adjust-plus flex-center"><i class="fas fa-search-plus"></i></li><li class="tools-item tool-font-adjust-minus flex-center"><i class="fas fa-search-minus"></i></li><li class="tools-item tool-expand-width flex-center"><i class="fas fa-arrows-alt-h"></i></li><li class="tools-item tool-dark-light-toggle flex-center"><i class="fas fa-moon"></i></li><li class="tools-item tool-scroll-to-top flex-center"><i class="fas fa-arrow-up"></i></li><li class="tools-item tool-scroll-to-bottom flex-center"><i class="fas fa-arrow-down"></i></li></ul><ul class="exposed-tools-list"><li class="tools-item tool-toggle-show flex-center"><i class="fas fa-cog fa-spin"></i></li></ul></div></div><aside class="page-aside">.post-toc-wrap{width:100%;font-size:.92rem;box-sizing:border-box;margin:0;padding:0 2px 12px 10px;text-align:left}a{transition-property:all}.active>.nav-child{display:block}.active-current>.nav-child{display:block}.nav-text{color:var(--default-text-color)}</aside><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fas fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="Search..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fas fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fas fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/utils.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/main.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/header-shrink.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/back2top.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/dark-light-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/local-search.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/lazyload.js"></script><div class="post-scripts"><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/left-side-toggle.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/libs/anime.min.js"></script><script src="//cdn.jsdelivr.net/npm/hexo-theme-keep@3.4.2/source/js/toc.js"></script></div></body></html>